#!/bin/sh

autostart() {
    case "$(readlink /sbin/init | cut -f3 -d'/')" in
        systemd)
            systemctl --user import-environment DISPLAY XAUTHORITY &
            ;;
        runit-init)
            runsvdir "$HOME/.local/service" &
            ;;
        *) printf "[ %s ]: xprofile: INIT SYSTEM not recognised" "$(date)" >> errors.log ;;
    esac
}

xrdb "${XDG_CONFIG_HOME:-$HOME/.config}/x11/Xresources" &
xrdbpid=$!

case $(hostname) in
    VoiD)
        xrandr --output HDMI-0 --off --output DVI-D-0 --auto
        # xrandr --output HDMI-0 --off --output DVI-D-0 --auto --scale 2
        # xrandr --output HDMI-0 --primary --auto --output DVI-D-0 --off
        ;;
    vDR)
        xbacklight -set 20 &
        libinput-gestures-setup start &
        bluetooth off &
        ;;
    void)
        libinput-gestures-setup start &
        nm-tray &
        cbatticon &
        ;;
    tinkerboard)
        {
            sleep 30
            emacsclient -c -e '(doom/quickload-session)' -a emacs &
        } &
        ;;
    NT)
        xbacklight -set 30 &
        ;;
esac

COMMON_AUTOSTART='remaps setbg numlockx mem-warn'
for program in $COMMON_AUTOSTART; do
    pidof -sx "$program" ||
        "$program" &
done >/dev/null 2>&1
sysact Start &

[ -n "$xrdbpid" ] && wait "$xrdbpid"
xset dpms 0 0 180
