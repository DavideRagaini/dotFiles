#!/bin/sh

case "$(readlink /sbin/init | cut -f3 -d'/')" in
    systemd)
        systemctl --user import-environment DISPLAY XAUTHORITY &
        ;;
    runit-init)
        {
        sleep 10
        runsvdir "$HOME/.local/service" &
        } &
        ;;
    *) printf "[ %s ]: xprofile: INIT SYSTEM not recognised" "$(date)" >> ~/errors.log ;;
esac

autostart(){
    sleep "$1"
    emacsclient -c -e '(doom/quickload-session)' &
    sleep "$2"
    librewolf &
}

xrdb "${XDG_CONFIG_HOME:-$HOME/.config}/x11/Xresources" &
xrdbpid=$!

case $(hostname) in
    VoiD)
        export LIBVA_DRIVER_NAME=vdpau
        export VDPAU_DRIVER=nvidia
        # xrandr --output DVI-D-0 --primary --mode 1920x1080 --pos 0x0 --rotate normal --output HDMI-0 --mode 3840x2160 --scale 0.5 --pos 3840x0 --rotate normal
        autostart 60 30 &
        mem-warn -i 60 -t 1000 &
          ;;
    vDR)
        xbacklight -set 20 &
        libinput-gestures-setup start &
        bluetooth off &
        mem-warn -i 60 -t 1000 &
        autostart 20 10 &
        ;;
    void)
        xbacklight -set 20 &
        libinput-gestures-setup start &
        mem-warn &
        ;;
    tinkerboard) mem-warn &
        ;;
    NT) mem-warn &
        ;;
esac

remaps &
setbg &
numlockx &
xset dpms 0 0 180

{
    [ "$(stat -c %y \"\$HOME/.cache/snooze/daily\" 2>/dev/null | cut -d' ' -f1)" = "$(date '+%Y-%m-%d')" ] ||
        {
            sleep 10m
            run-parts "$HOME/.local/bin/snooze/daily" > "$HOME/.cache/snooze/daily" 2>&1
        }
} &

[ -n "$xrdbpid" ] && wait "$xrdbpid"
