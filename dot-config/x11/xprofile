#!/bin/sh

xrdb "${XDG_CONFIG_HOME:-$HOME/.config}/x11/Xresources" &
xrdbpid=$!

autostart(){
    sleep "$1"
    # systemctl start --user graphical-session.target
    systemctl start --user picom.service
    systemctl start --user clipmenu.service
    sleep "$2"
    # "$HOME/.local/bin/nix/thorium" &
    brave &
    sleep "$3"
    systemctl is-active --quiet openvpn-europe.service &&
        qbittorrent &
    sleep "$4"
    alacritty --class 'emacs,emacs' -T 'alacritty-emacsclient' -e emacsclient -e '(doom/quickload-session t)' -nw &
}

locker(){
    LOCK_TIME=5 # Minutes
    NOTIFY=45 # Seconds
    xautolock \
        -time "$LOCK_TIME" \
        -notify "$NOTIFY" \
        -notifier "notify-send -u critical -t ${NOTIFY}000 'System will be locked' '$NOTIFY seconds left'" \
        -locker 'systemctl suspend'
}

case $(hostname) in
    Apollo)
        export LIBVA_DRIVER_NAME=vdpau
        export VDPAU_DRIVER=nvidia
        # xrandr --output DVI-D-0 --primary --mode 1920x1080 --pos 0x0 --rotate normal --output HDMI-0 --mode 3840x2160 --scale 0.5 --pos 3840x0 --rotate normal
        xrandr --output DVI-D-0 --primary --mode 1920x1080 --pos 0x0 --rotate normal --output HDMI-0 --off
        autostart 10 10 10 45 &
        locker &
        conky &
        ;;
    # vDR)
    #     xbacklight -set 20 &
    #     libinput-gestures-setup start &
    #     bluetooth off &
    #     mem-warn -i 60 -t 1000 &
    #     autostart 20 10 &
    #     ;;
    void)
        xbacklight -set 20 &
        libinput-gestures-setup start &
        mem-warn &
        ;;
    tinkerboard)
        mem-warn &
        autostart 15 10 &
        ;;
    NT) mem-warn &
        ;;
esac

remaps &
setbg &
numlockx &
xset dpms 0 0 180

[ -n "$xrdbpid" ] && wait "$xrdbpid"
